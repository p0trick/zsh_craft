# Zsh Craft Backend

Zsh Craft é¡¹ç›®çš„åç«¯æœåŠ¡ï¼ŒåŸºäº Go è¯­è¨€æ„å»ºçš„è½»é‡çº§ Web æœåŠ¡å™¨ã€‚

## ğŸš€ æŠ€æœ¯æ ˆ

- **Go 1.24+**: é«˜æ€§èƒ½çš„ç¼–ç¨‹è¯­è¨€
- **æ ‡å‡†åº“**: ä½¿ç”¨ Go æ ‡å‡†åº“æ„å»º HTTP æœåŠ¡
- **åµŒå…¥å¼æ–‡ä»¶ç³»ç»Ÿ**: ä½¿ç”¨ `embed` åŒ…åµŒå…¥å‰ç«¯é™æ€æ–‡ä»¶
- **JSON å¤„ç†**: åŸç”Ÿ JSON ç¼–è§£ç 
- **æ–‡ä»¶æ“ä½œ**: å®‰å…¨çš„æ–‡ä»¶è¯»å†™æ“ä½œ

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
go mod tidy
```

## ğŸ› ï¸ å¼€å‘å‘½ä»¤

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
go run main.go
```
æœåŠ¡å™¨å°†åœ¨ http://localhost:8080 å¯åŠ¨

### æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
```bash
go build -o zsh_craft_backend main.go
```

### è¿è¡Œæµ‹è¯•
```bash
go test ./...
```

### ä»£ç æ ¼å¼åŒ–
```bash
go fmt ./...
```

### ä»£ç æ£€æŸ¥
```bash
go vet ./...
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ main.go              # ä¸»æœåŠ¡æ–‡ä»¶
â”œâ”€â”€ go.mod               # Go æ¨¡å—æ–‡ä»¶
â”œâ”€â”€ go.sum               # ä¾èµ–æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ dist/                # å‰ç«¯æ„å»ºæ–‡ä»¶ (è‡ªåŠ¨ç”Ÿæˆ)
â””â”€â”€ README.md            # åç«¯è¯´æ˜æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. é™æ€æ–‡ä»¶æœåŠ¡
- ä½¿ç”¨ `embed` åŒ…åµŒå…¥å‰ç«¯æ„å»ºæ–‡ä»¶
- è‡ªåŠ¨æœåŠ¡ `dist` ç›®å½•ä¸­çš„é™æ€èµ„æº
- æ”¯æŒ SPA è·¯ç”±

### 2. API æ¥å£

#### åº”ç”¨é…ç½®æ¥å£
```go
POST /api/apply_config
```
- åŠŸèƒ½ï¼šå°†é…ç½®åº”ç”¨åˆ°ç”¨æˆ·çš„ `.zshrc` æ–‡ä»¶
- è¯·æ±‚ä½“ï¼š
  ```json
  {
    "zshrc_content": "ç”Ÿæˆçš„ zshrc å†…å®¹",
    "zsh_config": "é…ç½®çš„ JSON å­—ç¬¦ä¸²"
  }
  ```
- å“åº”ï¼š
  ```json
  {
    "success": true,
    "message": "é…ç½®åº”ç”¨æˆåŠŸ"
  }
  ```

#### ä¿å­˜é…ç½®æ¥å£
```go
POST /api/save_config
```
- åŠŸèƒ½ï¼šä¿å­˜é…ç½®åˆ° `~/.zsh_cfg/zsh_config.json`
- è¯·æ±‚ä½“ï¼š
  ```json
  {
    "config": "é…ç½®çš„ JSON å­—ç¬¦ä¸²"
  }
  ```

#### åŠ è½½é…ç½®æ¥å£
```go
GET /api/load_config
```
- åŠŸèƒ½ï¼šä» `~/.zsh_cfg/zsh_config.json` åŠ è½½é…ç½®
- å“åº”ï¼š
  ```json
  {
    "success": true,
    "message": "é…ç½®åŠ è½½æˆåŠŸ",
    "config": "é…ç½®çš„ JSON å­—ç¬¦ä¸²"
  }
  ```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. æ–‡ä»¶æ“ä½œå®‰å…¨
- è‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶ (`.backup` åç¼€)
- å†™å…¥å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
- å®‰å…¨çš„æ–‡ä»¶æƒé™è®¾ç½® (0644)

### 2. é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è¿”å›
- ä¼˜é›…çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

### 3. CORS æ”¯æŒ
- æ”¯æŒè·¨åŸŸè¯·æ±‚
- é¢„æ£€è¯·æ±‚å¤„ç†
- å®‰å…¨çš„ CORS å¤´è®¾ç½®

## ğŸ“‚ æ–‡ä»¶ç®¡ç†

### åˆ›å»ºçš„æ–‡ä»¶ç»“æ„
```
~/
â”œâ”€â”€ .zshrc                    # ç”Ÿæˆçš„ Zsh é…ç½®æ–‡ä»¶
â”œâ”€â”€ .zsh_cfg/                 # é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ zsh_config.json      # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ zsh_config.json.backup # å¤‡ä»½æ–‡ä»¶
```

### æ–‡ä»¶æ“ä½œå‡½æ•°

#### `writeFile(path, content string) error`
- åˆ›å»ºå¤‡ä»½æ–‡ä»¶
- å†™å…¥æ–°å†…å®¹
- å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š

#### `copyFile(src, dst string) error`
- å®‰å…¨çš„æ–‡ä»¶å¤åˆ¶
- é”™è¯¯å¤„ç†
- èµ„æºæ¸…ç†

## ğŸŒ HTTP æœåŠ¡

### è·¯ç”±é…ç½®
```go
// é™æ€æ–‡ä»¶æœåŠ¡
http.Handle("/", fs)

// API è·¯ç”±
http.HandleFunc("/api/apply_config", applyConfigHandler)
http.HandleFunc("/api/save_config", saveConfigHandler)
http.HandleFunc("/api/load_config", loadConfigHandler)
```

### ä¸­é—´ä»¶åŠŸèƒ½
- CORS å¤´è®¾ç½®
- è¯·æ±‚æ–¹æ³•éªŒè¯
- å†…å®¹ç±»å‹æ£€æŸ¥
- é”™è¯¯å“åº”æ ¼å¼åŒ–

## ğŸ” è°ƒè¯•å’Œæ—¥å¿—

### æ—¥å¿—è¾“å‡º
- æœåŠ¡å™¨å¯åŠ¨ä¿¡æ¯
- é”™è¯¯æ—¥å¿—è®°å½•
- æ“ä½œçŠ¶æ€åé¦ˆ

### è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
go run main.go -debug
```

## ğŸš€ éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ
```bash
go run main.go
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
go build -o zsh_craft_backend main.go

# è¿è¡ŒæœåŠ¡
./zsh_craft_backend
```

### Docker éƒ¨ç½²
```dockerfile
FROM golang:1.24-alpine AS builder
WORKDIR /app
COPY . .
RUN go build -o zsh_craft_backend main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/zsh_craft_backend .
EXPOSE 8080
CMD ["./zsh_craft_backend"]
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. é™æ€æ–‡ä»¶ä¼˜åŒ–
- ä½¿ç”¨ `embed` åŒ…å‡å°‘æ–‡ä»¶ I/O
- å‹ç¼©é™æ€èµ„æº
- ç¼“å­˜ç­–ç•¥

### 2. å†…å­˜ç®¡ç†
- é«˜æ•ˆçš„æ–‡ä»¶è¯»å†™
- åŠæ—¶é‡Šæ”¾èµ„æº
- é¿å…å†…å­˜æ³„æ¼

### 3. å¹¶å‘å¤„ç†
- æ”¯æŒå¹¶å‘è¯·æ±‚
- çº¿ç¨‹å®‰å…¨çš„æ–‡ä»¶æ“ä½œ
- åˆç†çš„é”™è¯¯å¤„ç†

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
```bash
go test -v ./...
```

### é›†æˆæµ‹è¯•
```bash
go test -v -tags=integration ./...
```

### æ€§èƒ½æµ‹è¯•
```bash
go test -bench=. ./...
```

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡
```bash
# æœåŠ¡å™¨ç«¯å£
PORT=8080

# è°ƒè¯•æ¨¡å¼
DEBUG=true

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=info
```

### å‘½ä»¤è¡Œå‚æ•°
```bash
# æŒ‡å®šç«¯å£
go run main.go -port 8080

# å¯ç”¨è°ƒè¯•
go run main.go -debug

# æŒ‡å®šé…ç½®æ–‡ä»¶
go run main.go -config config.json
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£ä½¿ç”¨æƒ…å†µ
   lsof -i :8080
   
   # æ€æ­»å ç”¨è¿›ç¨‹
   kill -9 <PID>
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # æ£€æŸ¥æ–‡ä»¶æƒé™
   ls -la ~/.zshrc
   
   # ä¿®å¤æƒé™
   chmod 644 ~/.zshrc
   ```

3. **æ–‡ä»¶ä¸å­˜åœ¨**
   ```bash
   # åˆ›å»ºå¿…è¦ç›®å½•
   mkdir -p ~/.zsh_cfg
   ```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f /var/log/zsh_craft.log

# æœç´¢é”™è¯¯
grep "ERROR" /var/log/zsh_craft.log
```

## ğŸ“ ä»£ç è§„èŒƒ

- éµå¾ª Go å®˜æ–¹ä»£ç è§„èŒƒ
- ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–ä»£ç 
- æ·»åŠ é€‚å½“çš„æ³¨é‡Š
- é”™è¯¯å¤„ç†è¦å®Œæ•´

## ğŸ¤ è´¡çŒ®

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---

**Zsh Craft Backend** - é«˜æ€§èƒ½çš„ Zsh é…ç½®ç®¡ç†åç«¯æœåŠ¡ âš¡ 